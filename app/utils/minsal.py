import requests
from fastapi import HTTPException

def obtener_datos_locales_turnos():
    """Obtiene datos desde la URL proporcionada y los guarda en una variable."""

    url = "https://midas.minsal.cl/farmacia_v2/WS/getLocalesTurnos.php"

    try:
        # Hacer la solicitud GET a la URL
        response = requests.get(url)

        # Verificar si la solicitud fue exitosa
        if response.status_code == 200:
            # # Convertir la respuesta JSON en un diccionario de Python
            # mock = [{"fecha":"2024-08-22","local_id":"5","fk_region":"6","fk_comuna":"56","fk_localidad":"12","local_nombre":"AHUMADA","comuna_nombre":"LA CALERA","localidad_nombre":"LA CALERA","local_direccion":"J J PEREZ 199","funcionamiento_hora_apertura":"09:00:00","funcionamiento_hora_cierre":"08:59:00","local_telefono":"+563326316573","local_lat":"-32.7882065329844","local_lng":"-71.189446195146","funcionamiento_dia":"jueves"},{"fecha":"2024-08-22","local_id":"27","fk_region":"6","fk_comuna":"59","fk_localidad":"17","local_nombre":"CRUZ VERDE","comuna_nombre":"LIMACHE","localidad_nombre":"LIMACHE","local_direccion":"URMENETA 96","funcionamiento_hora_apertura":"09:00:00","funcionamiento_hora_cierre":"08:59:00","local_telefono":"+562414551","local_lat":"-32.9853313679932","local_lng":"-71.2759083062112","funcionamiento_dia":"jueves"},{"fecha":"2024-08-22","local_id":"63","fk_region":"6","fk_comuna":"71","fk_localidad":"34","local_nombre":"CRUZ VERDE","comuna_nombre":"QUINTERO","localidad_nombre":"QUINTERO","local_direccion":"CABO ORTIZ N° 189","funcionamiento_hora_apertura":"09:00:00","funcionamiento_hora_cierre":"08:59:00","local_telefono":"+56322931269","local_lat":"-32.784714476685","local_lng":"-71.5274971892257","funcionamiento_dia":"jueves"},{"fecha":"2024-07-01","local_id":"81","fk_region":"6","fk_comuna":"80","fk_localidad":"41","local_nombre":"AHUMADA","comuna_nombre":"VIÑA DEL MAR","localidad_nombre":"VIÑA DEL MAR URGENCIA","local_direccion":"AV. LIBERTAD N° 335","funcionamiento_hora_apertura":"00:00:00","funcionamiento_hora_cierre":"23:59:00","local_telefono":"+560226313145","local_lat":"-33.0189172526154","local_lng":"-71.5510733225955","funcionamiento_dia":"miercoles"},{"fecha":"2024-07-01","local_id":"94","fk_region":"6","fk_comuna":"80","fk_localidad":"41","local_nombre":"CRUZ VERDE","comuna_nombre":"VIÑA DEL MAR","localidad_nombre":"VIÑA DEL MAR URGENCIA","local_direccion":"AV. VALPARAISO N° 404","funcionamiento_hora_apertura":"00:00:00","funcionamiento_hora_cierre":"23:59:00","local_telefono":"+56322714044","local_lat":"-33.024369299178","local_lng":"-71.5569460874684","funcionamiento_dia":"miercoles"},{"fecha":"2024-08-22","local_id":"154","fk_region":"6","fk_comuna":"78","fk_localidad":"2","local_nombre":"CRUZ VERDE","comuna_nombre":"VALPARAISO","localidad_nombre":"PLAN VALPARAISO","local_direccion":"AV. PEDRO MONTT N° 2705","funcionamiento_hora_apertura":"09:00:00","funcionamiento_hora_cierre":"23:00:00","local_telefono":"+56322214500","local_lat":"-33.0472612758337","local_lng":"-71.6079371834462","funcionamiento_dia":"jueves"},{"fecha":"2024-08-22","local_id":"158","fk_region":"6","fk_comuna":"78","fk_localidad":"27","local_nombre":"CRUZ VERDE","comuna_nombre":"VALPARAISO","localidad_nombre":"PLACILLA","local_direccion":"OBISPO VALDEZ SUBERCASEAUX N° 1170 LOCAL 6 Y 7 PLACILLA","funcionamiento_hora_apertura":"09:00:00","funcionamiento_hora_cierre":"23:00:00","local_telefono":"+56392292916","local_lat":"-33.1187010681137","local_lng":"-71.5713998255228","funcionamiento_dia":"jueves"},{"fecha":"2024-07-01","local_id":"186","fk_region":"6","fk_comuna":"78","fk_localidad":"1","local_nombre":"CRUZ VERDE","comuna_nombre":"VALPARAISO","localidad_nombre":"VALPARAISO URGENCIA","local_direccion":"AV. PEDRO MONTT 1902","funcionamiento_hora_apertura":"00:00:00","funcionamiento_hora_cierre":"23:59:00","local_telefono":"+56322745048","local_lat":"-33.0470628068749","local_lng":"-71.6169778733873","funcionamiento_dia":"miercoles"},{"fecha":"2024-08-22","local_id":"208","fk_region":"6","fk_comuna":"48","fk_localidad":"5","local_nombre":"SAN SEBASTIAN","comuna_nombre":"CARTAGENA","localidad_nombre":"CARTAGENA","local_direccion":"CASANOVA Nº 328","funcionamiento_hora_apertura":"09:00:00","funcionamiento_hora_cierre":"23:00:00","local_telefono":"+562451357","local_lat":"-33.547220627122","local_lng":"-71.6031519364708","funcionamiento_dia":"jueves"},{"fecha":"2024-08-22","local_id":"216","fk_region":"6","fk_comuna":"73","fk_localidad":"19","local_nombre":"MASTER","comuna_nombre":"SAN ANTONIO","localidad_nombre":"SAN ANTONIO","local_direccion":"LUIS REUS Nª 273 L.4","funcionamiento_hora_apertura":"09:00:00","funcionamiento_hora_cierre":"08:59:00","local_telefono":"+56352588604","local_lat":"-33.5883437717979","local_lng":"-71.6082114019404","funcionamiento_dia":"jueves"},{"fecha":"2024-08-22","local_id":"246","fk_region":"6","fk_comuna":"46","fk_localidad":"4","local_nombre":"ECOFARMACIAS","comuna_nombre":"CABILDO","localidad_nombre":"CABILDO","local_direccion":"AV. HUMERES N° 688","funcionamiento_hora_apertura":"09:00:00","funcionamiento_hora_cierre":"23:00:00","local_telefono":"+56332761259","local_lat":"-32.4263559185527","local_lng":"-71.0670595672433","funcionamiento_dia":"jueves"}]

            datos = response.json()

            # Guardar los datos en una variable
            return datos
        else:
            raise HTTPException(status_code=response.status_code, detail="Error al obtener los datos desde la URL")
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"Error al obtener los datos desde la URL: {str(e)}")